---
title: "R Finals"
output: html_notebook
---

# Introdução
O seguinte projeto é o trabalho final da disciplina de *Introdução ao R Aplicado em Ciência de Dados*, da EPGE.

Utilizaremos dados estatísticos da Secretaria de Segurança Pública do Estado de São Paulo, disponíveis para download em https://basedosdados.org/dataset/br-sp-gov-ssp, e a planilha de informações dos municípios do estado de São Paulo, elaborada pelo IBGE e disponível em https://www.ibge.gov.br/cidades-e-estados/sp/sao-paulo.html. Os dois arquivos .csv baixados já estão no repositório GitHub desse projeto, e portanto, tendo-o clonado na sua máquina, não é necessário realizar o download nas fontes.

# Preparação
## Importando os pacotes
```{r}
install.packages("tidyverse")

library(tidyverse)
library(readxl) #apesar de ser baixado no pacote "tidyverse", precisamos carregar separadamente
```

## Importando a base de dados

Lendo duas linhas do arquivo para verificar o formato do CSV (evitando assim erros com o delimitador no momento de salvar os dados, por exemplo)
```{r}
read_lines("ocorrencias_registradas.csv", n_max = 2)
```
Já podemos reparar que teremos dados NA na nossa base, porém resolveremos isso mais a diante. Como o separador é vírgula, podemos utilizar o leitor de CSV padrão.

```{r}
ssp <- read_csv("ocorrencias_registradas.csv")
```

Também utilizaremos a planilha do IBGE com os municípios do estado de São Paulo. Analisando os dados, percebemos que as duas primeiras linhas não contém dados, e após a linha 645, temos metadados e fontes da base. Também reparamos que o símbolo "-" é utilizado para representar NA. Todos esses detalhes foram considerados ao ler o arquivo no projeto. 

```{r}
mun <- read_excel("sp-municipios.xlsx", na="-", skip = 2, n_max = 645)
```

## Primeiras olhadas nos DFs

Vamos verificar se estamos utilizando dataframes do tipo Tibble. 
```{r}
class(ssp)
class(mun)
```
### Dataframe principal (SSP)
```{r}
spec(ssp)
```
```{r}
meta_ssp <- names(ssp)
meta_ssp
```

```{r}
head(ssp)
```

### Dataframe secundário (MUN)

```{r}
head(mun)
```

```{r}
meta_mun <- names(mun)
meta_mun
```
## Limpando os dados


Primeiro, retiramos colunas desnecessárias do MUN. 
```{r}
mun2 <- mun %>%
  select(!c(3,4,11,12))

names(mun2)
```
Depois, renomeamos as colunas por questão de simplificação. 

```{r}
colnames(mun2) <- c("mun", "id", "area", "pop", "den", "escol", "idh", "mort_inf", "PIB_percap")
names(mun2)
```

